name: 'Update comment'

description: 'This action is intended to update comment with given content, e.g. workflow run link'

inputs:
  comment-id:
    description: 'Id of the comment'
    required: true
  content:
    description: 'Content to add'
    required: true
  github-token:
    description: 'Repository token'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Get comment content
      id: get-old-comment
      shell: bash
      run: |
        OLD_BODY=$(curl -L -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ inputs.github-token }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/intel-innersource/applications.ai.enterprise-rag.enterprise-ai-solution/issues/comments/${{ inputs.comment-id }} \
          | jq .body)
        echo "old_body=$(echo ${OLD_BODY} | sed 's/\"//g')"
        echo "old_body=$(echo ${OLD_BODY} | sed 's/\"//g')" >> $GITHUB_OUTPUT

    - name: Add given content
      id: prepare-new-comment
      shell: bash
      run: |
        echo "new_body=${{ steps.get-old-comment.outputs.old_body }} \n ${{ inputs.content }}" >> $GITHUB_OUTPUT

    - name: Update comment
      shell: bash
      run: |
        curl -L -X PATCH -H "Accept: application/vnd.github+json" \
          -H "Authorization: Bearer ${{ inputs.github-token }}" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          https://api.github.com/repos/intel-innersource/applications.ai.enterprise-rag.enterprise-ai-solution/issues/comments/${{ inputs.comment-id }} \
          -d '{"body":"${{ steps.prepare-new-comment.outputs.new_body }}"}'
