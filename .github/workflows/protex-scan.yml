name: "Protex Scan"

on:
  workflow_dispatch:
    inputs:
      PR_number:
        description: 'Pull request number'
        required: true

  pull_request:
    branches: [ main ]

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

env:
  PR-number: ${{ github.event.inputs.PR_number || github.event.number }}

jobs:
  Protex-scan:
    if: ${{ github.repository == 'intel-innersource/applications.ai.enterprise-rag.enterprise-ai-solution' }}
    runs-on: [innersource.prod.amr.dind]
    container: cache-registry.caas.intel.com/cache/library/python:3.11
    name: Protex Scan
    environment: default
    permissions:
      id-token: write
      contents: read
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Adjust BuildConfig
      run: |
        cp .github/BuildConfigProtex.json .github/BuildConfig.json
      shell: bash

    - name: SDL scan
      uses: ./.github/actions/sdl-scan
      with:
        Repository-name: ${{ github.repository }}
        PR-number: ${{ env.PR-number }}
