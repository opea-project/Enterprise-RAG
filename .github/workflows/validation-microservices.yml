name: "Microservices validation"

on:
  issue_comment:
    types: [created]

jobs:
    validate-microservices:
      if: |
        (github.event.issue.pull_request) && contains(github.event.comment.body, '/RunTests') &&
        (github.repository == 'intel-innersource/applications.ai.enterprise-rag.enterprise-ai-solution')
      name: "Validation :: Microservices"
      runs-on: [ innersource.prod.amr.dind ]
      container: cache-registry.caas.intel.com/cache/library/ubuntu:24.04
      environment: default
      concurrency:
        group: validation
      permissions:
        contents: read
        id-token: write
        issues: write
        pull-requests: write
      defaults:
        run:
          shell: bash
      env:
        REMOTE_GAUDI_HOST: dcgaudicluster1
        REMOTE_WORKSPACE: "/tmp/${{ github.event.issue.number }}/${{ github.run_number }}/${{ github.run_attempt }}"
        SPECIFIC_TESTS: ""
      steps:
      - name: Checkout actions
        uses: actions/checkout@v4

      - name: Validation tests
        uses: ./.github/actions/validation-tests
        with:
          Repository-name: ${{ github.repository }}
          PR-number: ${{ github.event.issue.number }}
          SSH_KEY: ${{ secrets.SSH_KEY }}
          SSH_CONFIG: ${{ secrets.SSH_CONFIG }}
          SSH_GAUDI1_KNOWN_HOSTS: ${{ secrets.SSH_GAUDI1_KNOWN_HOSTS }}
          RAG_SOLUTION_INFRA_PAT: ${{ secrets.RAG_SOLUTION_INFRA_PAT }}
