# Copyright (C) 2024-2026 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

apiVersion: gmc.opea.io/v1alpha3
kind: GMConnector
metadata:
  labels:
    app.kubernetes.io/name: gmconnector
    app.kubernetes.io/managed-by: kustomize
    gmc/platform: gaudi
  name: docsum
  namespace: docsum
spec:
  routerConfig:
    name: router
    serviceName: router-service
  nodes:
    root:
      routerType: Sequence
      steps:
      - name: TextExtractor
        dependency: Hard
        internalService:
          serviceName: text-extractor-svc
          config:
            endpoint: /v1/text_extractor
      - name: TextCompression
        dependency: Hard
        data: $response
        internalService:
          serviceName: text-compression-svc
          config:
            endpoint: /v1/text_compression
      - name: TextSplitter
        dependency: Hard
        data: $response
        internalService:
          serviceName: text-splitter-svc
          config:
            endpoint: /v1/text_splitter
            CHUNK_SIZE: "3584"
            CHUNK_OVERLAP: "512"
      - name: VLLMGaudi
        dependency: Hard
        internalService:
          serviceName: vllm-gaudi-svc
          config:
            endpoint: /v1/completions
          isDownstreamService: true
      - name: Llm
        dependency: Hard
        internalService:
          serviceName: llm-svc
          config:
            endpoint: /v1/chat/completions
            LLM_MODEL_SERVER: vllm
            LLM_MODEL_SERVER_ENDPOINT: vllm-gaudi-svc
          isDownstreamService: true
      - name: DocSum
        data: $response
        dependency: Hard
        internalService:
          serviceName: docsum-svc
          config:
            endpoint: /v1/docsum
            DOCSUM_LLM_USVC_ENDPOINT: llm-svc
