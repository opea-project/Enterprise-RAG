# Copyright (C) 2024-2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

---
velero:
  enabled: false
  namespace: "velero"

  velero_pod_labels:
    app.kubernetes.io/instance: velero
    app.kubernetes.io/name: velero

  install_server: true
  install_client: true
  # Set version of velero client to install: set specific one - e.g. "v1.16.1" or follow server version - "automatic"
  client_version: "automatic"
  # Whether to install a CSI snapshot class for default storage class driver
  install_snapshot_class: true
  snapshot_class_name: "csi-snapclass"
  # leave empty to generate snapshotclass configuration for default storage class in cluster
  snapshot_class_driver: ""

  storageType: minio

  # name of a velero Backup resource, created in result of backup in velero namespace;
  # if not specified, most recent backup resource will be looked up.
  restore_from: ""
  # for getting backup details use server or client, if it's properly configured
  backup_details_from: "server"


  backup:
    prefix: backup
    restore_prefix: restore
    backupConfig:
      namespaceOrder: [auth, fingerprint, chatqa, chat-history, edp, vdb, system]
      # selectors for resources to backup (or to exclude); multiple selectors will be ANDed
      resourceSelectors:
        - app.kubernetes.io/instance notin (torchserve_embedding,torchserve_reranking,vllm,vllm-gaudi)
      # list of deployments to be cleared in preparation for restore
      deployments:
        auth: [Helm/keycloak,Secret/keycloak,Secret/tls-secret]
        chatqa: [Deployment/embedding-svc-deployment, Deployment/fgp-svc-deployment, Deployment/input-scan-svc-deployment, Deployment/llm-svc-deployment, Deployment/prompt-template-svc-deployment, Deployment/reranking-svc-deployment, Deployment/retriever-svc-deployment, Deployment/router-service-deployment, Secret/mongo-database-secret,Secret/vector-database-config]
        chat-history: [Helm/chat-history,Secret/mongo-database-secret]
        edp: [Helm/edp,Secret/vector-database-config,Secret/tls-secret,Secret/vector-database-config]
        fingerprint: [Helm/fingerprint,Secret/mongo-database-secret]
        vdb: [Helm/vdb,Secret/vector-database-config]
        system: [Helm/gmc]

    # labels to apply to backup object itself
    labels:
      backup-reason: regular
    # labels to apply to a restore object
    restore_labels:
      restore-reason: recovery
    itemOperationTimeout: 2h0m0s
    csiSnapshotTimeout: 2h0m0s
    ttl: 720h

