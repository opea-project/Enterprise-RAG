# Copyright (C) 2025 Intel Corporation
# SPDX-License-Identifier: Apache-2.0
---
- name: Verify if velero is enabled for backup and restore operations
  ansible.builtin.fail:
    msg: Velero must be enabled for backup and restore operations.
  when: not velero.enabled

- name: Wait for velero pods to be ready
  kubernetes.core.k8s_info:
    kind: Pod
    namespace: "{{ velero.namespace }}"
    label_selectors:
      - app.kubernetes.io/name=velero
  register: velero_pods_info
  until: velero_pods_info.resources | length > 0 and velero_pods_info.resources[0].status.phase == "Running"
  retries: 3
  delay: 10
