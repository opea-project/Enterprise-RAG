{#
Copyright (C) 2024-2026 Intel Corporation
SPDX-License-Identifier: Apache-2.0
#}
{% if ((balloons is defined and balloons.enabled and (optimal_replicas.total_replicas | default(none) is not none)) or (maxReplicasGaudi_VLLM is defined and maxReplicasGaudi_VLLM and (optimal_replicas.gaudi_nodes_count | default(none) is not none))) and not (upload_pipelines | default(false) | bool) %}
services:
{% if balloons is defined and balloons.enabled and (optimal_replicas.total_replicas | default(none) is not none) %}
  vllm:
    hpa:
      minReplicas: {{ optimal_replicas.total_replicas }}
      maxReplicas: {{ optimal_replicas.total_replicas }}
  torchserve_reranking:
    hpa:
      minReplicas: {{ (optimal_replicas.total_replicas | int(0)) + ((optimal_replicas.gaudi_nodes_count | int(0)) * (maxReplicasGaudi_VLLM | default(0) | int)) }}
      maxReplicas: {{ (optimal_replicas.total_replicas | int(0)) + ((optimal_replicas.gaudi_nodes_count | int(0)) * (maxReplicasGaudi_VLLM | default(0) | int)) }}
  torchserve_embedding:
    hpa:
      minReplicas: {{ (optimal_replicas.total_replicas | int(0)) + ((optimal_replicas.gaudi_nodes_count | int(0)) * (maxReplicasGaudi_VLLM | default(0) | int)) }}
      maxReplicas: {{ (optimal_replicas.total_replicas | int(0)) + ((optimal_replicas.gaudi_nodes_count | int(0)) * (maxReplicasGaudi_VLLM | default(0) | int)) }}
{% endif %}
{% if maxReplicasGaudi_VLLM is defined and maxReplicasGaudi_VLLM and (optimal_replicas.gaudi_nodes_count | default(none) is not none) %}
  vllm_gaudi:
    replicas: {{ optimal_replicas.gaudi_nodes_count * (maxReplicasGaudi_VLLM | default(0) | int) }}
    hpa:
      minReplicas: {{ (optimal_replicas.gaudi_nodes_count | int(0)) * (maxReplicasGaudi_VLLM | default(0) | int) }}
      maxReplicas: {{ (optimal_replicas.gaudi_nodes_count | int(0)) * (maxReplicasGaudi_VLLM | default(0) | int) }}
{% endif %}
{% endif %}
