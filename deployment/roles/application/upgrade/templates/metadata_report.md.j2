# Metadata Check Report

**Generated:** {{ ansible_date_time.iso8601 }}  
**Status:** {{ metadata_verification_result.status | upper }}

---

## Executive Summary

- **Total Validations:** {{ metadata_verification_result.total_validations }}
- **Approved Changes:** {{ metadata_verification_result.approved_count }}
- **Mitigated Changes:** {{ metadata_verification_result.mitigated_count }}
- **Rejected Changes:** {{ metadata_verification_result.rejected_count }}
- **Mitigations Required:** {{ metadata_verification_result.mitigations_required }}
- **Mitigations Applied:** {{ metadata_verification_result.mitigations_applied }}
- **Mitigations Pending:** {{ metadata_verification_result.mitigations_pending }}

{% if metadata_verification_result.status == 'failed' %}
## âš ï¸ VERIFICATION FAILED

This upgrade cannot proceed due to pending mitigations or rejected changes.

{% endif %}

---

## Validation Details

{% for validation in metadata_validations | sort(attribute='component') %}
### {{ loop.index }}. Component: {{ validation.component }}

- **File:** `{{ validation.file }}`
- **Change Type:** {{ validation.change_type | default('N/A') }}
- **Change Path:** `{{ validation.change_path | default('N/A') }}`
- **Change Lines:** {{ validation.change_lines | default(0) }}
- **Response:** **{{ validation.response | upper }}**
- **Note:** {{ validation.note }}
{% if validation.mitigation_action is defined %}
- **Mitigation Action:** `{{ validation.mitigation_action }}`
{% endif %}
- **Timestamp:** {{ validation.timestamp }}

{% endfor %}

{% if metadata_validation_errors | length > 0 %}
---

## âŒ Rejected Changes

The following changes were rejected and require manual review:

{% for error in metadata_validation_errors %}
### {{ loop.index }}. {{ error.component }}

- **Change Path:** `{{ error.change_path }}`
- **Reason:** {{ error.reason }}

{% endfor %}
{% endif %}

{% if metadata_mitigations_required | length > 0 %}
---

## ðŸ”§ Required Mitigations

{% for mitigation in metadata_mitigations_required %}
### {{ loop.index }}. {{ mitigation.component }}

- **Action:** `{{ mitigation.action }}`
- **Change Path:** `{{ mitigation.change_path }}`
- **Status:** {{ mitigation.status | upper }}

{% endfor %}
{% endif %}

{% if metadata_mitigations_applied | length > 0 %}
---

## âœ… Applied Mitigations

{% for mitigation in metadata_mitigations_applied %}
### {{ loop.index }}. {{ mitigation.component }}

- **Action:** `{{ mitigation.action }}`
- **Applied At:** {{ mitigation.timestamp }}
- **Result:** {{ mitigation.result }}

{% endfor %}
{% endif %}

---

## Component Summary

{% for component in metadata_validations | map(attribute='component') | unique | sort %}
### {{ component }}

{% set component_validations = metadata_validations | selectattr('component', 'equalto', component) | list %}
- **Total Changes:** {{ component_validations | length }}
- **Approved:** {{ component_validations | selectattr('response', 'equalto', 'approve') | list | length }}
- **Mitigated:** {{ component_validations | selectattr('response', 'equalto', 'mitigate') | list | length }}
- **Rejected:** {{ component_validations | selectattr('response', 'equalto', 'reject') | list | length }}

{% endfor %}

---

## Conclusion

{% if metadata_verification_result.rejected_count > 0 %}
âŒ **Metadata verification REJECTED.**

There are {{ metadata_verification_result.rejected_count }} rejected change(s) that require manual review and cannot proceed.

**Action Required:** Review and address all rejected changes before proceeding with the upgrade.

{% elif metadata_verification_result.status == 'failed' %}
âŒ **Metadata verification failed.**

{% if metadata_verification_result.mitigations_pending > 0 %}
There are {{ metadata_verification_result.mitigations_pending }} pending mitigation(s) that must be addressed before proceeding.
{% endif %}

**Action Required:** Review and address all issues before proceeding with the upgrade.

{% else %}
âœ… **All metadata changes have been validated successfully.**

{% if metadata_verification_result.mitigated_count > 0 %}
All required mitigations have been applied and verified.
{% endif %}

The upgrade can proceed.

{% endif %}
