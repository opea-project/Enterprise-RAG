{#
Copyright (C) 2024-2026 Intel Corporation
SPDX-License-Identifier: Apache-2.0
#}

{% if vector_databases.vector_store == "pgvector" %}
vector_database_password: {{ POSTGRES_PASSWORD }}
vector_database_username: {{ vector_database_connection_username | default("edp") }}
vector_database_name: {{ vector_database_name | default("vdb") }}

pgvector:
  enabled: true

{% endif %}

{% if vector_databases.vector_store == "redis" %}
vector_database_password: {{ REDIS_PASSWORD }}

redis:
  enabled: true
  replicaCount: {{ vector_databases.redis.replicaCount | default(0) }}
  auth:
    password: {{ REDIS_PASSWORD }}

{% endif %}

{% if vector_databases.vector_store == "redis-cluster" %}

# Root-level values for service naming
namespace: {{ vector_databases.namespace }}
vectorStore: {{ vector_databases.vector_store }}

vector_database_password: {{ REDIS_PASSWORD }}

# Replica count for StatefulSet
replicaCount: {{ vector_databases[vector_databases.vector_store].cluster.nodes | default(3) }}

# Cluster configuration
cluster:
  nodes: {{ vector_databases[vector_databases.vector_store].cluster.nodes | default(3) }}
  replicas: {{ vector_databases[vector_databases.vector_store].cluster.replicas | default(0) }}

# Image configuration
image:
  repository: {{ vector_databases[vector_databases.vector_store].image.repository | default('redis') }}
  tag: "{{ vector_databases[vector_databases.vector_store].image.tag | default('8.2.2') }}"
  pullPolicy: {{ vector_databases[vector_databases.vector_store].image.pullPolicy | default('IfNotPresent') }}

# Redis configuration
config:
  maxmemory: "{{ vector_databases[vector_databases.vector_store].config.maxmemory | default('2gb') }}"
  maxmemory_policy: "{{ vector_databases[vector_databases.vector_store].config.maxmemory_policy | default('allkeys-lru') }}"

# Resources
resources:
  requests:
    cpu: "{{ vector_databases[vector_databases.vector_store].resources.requests.cpu | default('500m') }}"
    memory: "{{ vector_databases[vector_databases.vector_store].resources.requests.memory | default('512Mi') }}"
  limits:
    cpu: "{{ vector_databases[vector_databases.vector_store].resources.limits.cpu | default('2000m') }}"
    memory: "{{ vector_databases[vector_databases.vector_store].resources.limits.memory | default('4Gi') }}"

# Persistence
persistence:
  enabled: {{ vector_databases[vector_databases.vector_store].persistence.enabled | default(true) }}
  storageClass: "{{ vector_databases[vector_databases.vector_store].persistence.storageClass | default('') }}"
  size: "{{ vector_databases[vector_databases.vector_store].persistence.size | default('8Gi') }}"

# Metrics
metrics:
  enabled: true
  image:
    repository: oliver006/redis_exporter
    tag: v1.80.0
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 128Mi

{% endif %}
