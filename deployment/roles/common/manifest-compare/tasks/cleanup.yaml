# Copyright (C) 2025-2026 Intel Corporation
# SPDX-License-Identifier: Apache-2.0
---
# Initial cleanup of old metadata files at the start of upgrade workflow
# This ensures we start with a clean slate for the new upgrade assessment

- name: Clean up old metadata files
  ansible.builtin.find:
    paths: "{{ upgrade_metadata_dir }}"
    patterns:
      - "*-manifest.yaml"
      - "*-upgrade.yaml"
      - "*.transformed.yaml"
      - "*.processed.yaml"
      - "*-upgrade.diff"
  register: old_files_to_clean

- name: Remove old metadata files
  ansible.builtin.file:
    path: "{{ item.path }}"
    state: absent
  loop: "{{ old_files_to_clean.files }}"
  loop_control:
    label: "{{ item.path | basename }}"
  when: old_files_to_clean.files | length > 0
