# Copyright (C) 2025-2026 Intel Corporation
# SPDX-License-Identifier: Apache-2.0
---
# Default Validation Rules
# These rules are applied LAST (after component-specific rules)
# Using first-match logic: the first matching rule determines the action
#
# Rule matching logic (all use AND logic):
#   - path_regex only:  matches if path matches the regex
#   - data_regex only:  matches if content matches the regex
#   - both specified:   matches if BOTH path AND content match (AND logic)
#
# Examples:
#   path_regex: ".*password.*"              # matches any path containing "password"
#   data_regex: ".*password.*"              # matches any content containing "password"
#   path_regex: ".*config.*"                # matches paths with "config" AND
#   data_regex: ".*secret.*"                # content with "secret" (both required)

validation_rules:
  # Approve all formatting differences - these don't affect functionality

  # Empty diffs - no actual changes
  - path_regex: "^$"
    data_regex: "^$"
    response: "approve"
    note: "Empty diff - no changes detected"

  # Image tag changes for any service (common during upgrades)
  - data_regex: "^\\s*tag:\\s*.*$"
    response: "approve"
    note: "Image tag change - expected during version upgrades"

  # Resource requests/limits changes (CPU, memory)
  - path_regex: ".*/resources/(requests|limits)/(cpu|memory)$"
    data_regex: ".*"
    response: "approve"
    note: "Resource allocation changes - approved for performance tuning"

  # ERAG_VERSION changes (solution version)
  - data_regex: ".*ERAG_VERSION.*"
    response: "approve"
    note: "ERAG_VERSION change - expected during version upgrades"

  # vllmNodes configuration formatting
  - path_regex: ".*vllmNodes.*"
    response: "approve"
    note: "vllmNodes configuration formatting differences"

  # YAML multiline vs inline strings with escaped newlines (\n vs actual newlines)
  # - path_regex: ".*(extraEnv|extraVolumes|extraVolumeMounts|command|args|keycloakx).*"
  - path_regex: ".*(extraEnv|extraVolumes|extraVolumeMounts|command|args).*"
    response: "approve"
    note: "YAML formatting: multiline vs inline strings with escaped characters"

  # # Template formatting: inline with escaped quotes vs multiline
  # - path_regex: ".*modelChatTemplate.*"
  #   response: "approve"
  #   note: "Template formatting: inline vs multiline representation"

  # Backslash line continuation differences
  - path_regex: ".*"
    data_regex: ".*\\\\.*"
    response: "approve"
    note: "Backslash line continuation formatting differences"

  # Empty string formatting differences
  - path_regex: ".*(fullnameOverride|nameOverride).*"
    response: "approve"
    note: "Empty string formatting changes"

  # # vllmNodes formatting (multiline YAML differences)
  # - path_regex: ".*vllmNodes.*"
  #   response: "approve"
  #   note: "YAML structure formatting differences"

  # Default fallback - reject all other changes
  - path_regex: ".*"
    response: "reject"
    note: "Uncategorized changes require explicit approval - no matching rule found"
