# Copyright (C) 2025-2026 Intel Corporation
# SPDX-License-Identifier: Apache-2.0
---
# Component-specific validation rules for edp
# These rules are checked FIRST (before default rules)
# Using first-match logic: the first matching rule determines the action

validation_rules:
  # Disregard OIDC client secret changes (highest priority - security)
  - path_regex: ".*release-values.*"
    data_regex: ".*OidcClientSecret.*"
    response: "approve"
    note: "OIDC client secret may change"

  # Require mitigation for vector dimension changes
  - path_regex: ".*VECTOR_DIMS.*|.*vector_dims.*"
    response: "reject"
    note: "Vector dimension changes require verification of model compatibility and may require data re-indexing"

  # Require mitigation for ingestion configuration changes
  - path_regex: ".*ingestion.*"
    data_regex: ".*batch.*|.*chunk.*"
    response: "mitigate"
    action: "verify_ingestion_config"
    note: "Ingestion configuration changes require validation of processing pipeline"

  # Approve YAML formatting changes (multiline vs inline strings, escaped newlines)
  - path_regex: ".*(extraEnv|extraVolumes|extraVolumeMounts|command|args|configurationSnippet).*"
    response: "approve"
    note: "YAML formatting changes (multiline/inline) do not affect functionality"

  # Approve all other edp changes (formatting only when no config changes)
  - path_regex: ".*"
    response: "approve"
    note: "Formatting differences in EDP configuration"

  # Approve template formatting changes
  - path_regex: ".*modelChatTemplate.*"
    response: "approve"
    note: "Template formatting changes do not affect functionality"

  # Approve fullnameOverride/nameOverride empty string changes
  - path_regex: ".*(fullnameOverride|nameOverride).*"
    response: "approve"
    note: "Empty string formatting changes in override fields"

  # Reject all other edp changes
  - path_regex: ".*"
    response: "reject"
    note: "Unsupported changes affecting EDP require explicit approval"
