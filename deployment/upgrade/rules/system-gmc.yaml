# Copyright (C) 2025-2026 Intel Corporation
# SPDX-License-Identifier: Apache-2.0
---
# Component-specific validation rules for system-gmc
# These rules are checked FIRST (before default rules)
# Using first-match logic: the first matching rule determines the action
#
# Rule matching logic (all use AND logic):
#   - path_regex only:  matches if path matches the regex
#   - data_regex only:  matches if content matches the regex
#   - both specified:   matches if BOTH path AND content match (AND logic)

validation_rules:
  # Approve TORCHSERVE_AMP_DTYPE changes (BF16/FP32 precision settings)
  - path_regex: ".*TORCHSERVE_AMP_DTYPE.*"
    data_regex: "(BF16|FP32|FP16)"
    response: "approve"
    note: "TORCHSERVE_AMP_DTYPE precision setting change - approved for performance optimization"

  # Approve template formatting changes (escaped quotes, multiline vs inline)
  - path_regex: ".*modelChatTemplate.*"
    response: "approve"
    note: "Template formatting changes do not affect functionality"

  - path_regex: "embedding-usvc-config"
    data_regex: ".*EMBEDDING_MODEL_NAME.*"
    response: "reject"
    note: "changing EMBEDDING_MODEL_NAME breaks operation of deployed solution"

  # Approve VECTOR_STORE configuration changes from redis-cluster to redis
  - path_regex: ".*VECTOR_STORE.*"
    data_regex: "redis-cluster|redis"
    response: "approve"
    note: "VECTOR_STORE configuration change from redis-cluster to redis is approved"

  # Approve vector_store configuration changes (lowercase variant)
  - path_regex: ".*vector_store.*"
    data_regex: "redis-cluster|redis"
    response: "approve"
    note: "vector_store configuration change from redis-cluster to redis is approved"

  # Approve retriever-usvc configuration changes
  - path_regex: ".*retriever-usvc.*"
    data_regex: "redis-cluster|redis|VECTOR_STORE"
    response: "approve"
    note: "Retriever USVC configuration changes for vector store migration are approved"

  # Approve all other system-gmc changes (formatting only when no config changes)
  - path_regex: ".*"
    response: "approve"
    note: "Formatting differences in system-gmc configuration"
